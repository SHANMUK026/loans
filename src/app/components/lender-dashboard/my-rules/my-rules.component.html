<div class="my-rules-container">
  <header class="page-header">
    <div class="header-content">
      <button class="back-btn" (click)="goBack()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 12H5"/>
          <polyline points="12,19 5,12 12,5"/>
        </svg>
        Back to Dashboard
      </button>
      <div class="header-info">
        <h1>My Lending Rules</h1>
        <p>Manage your lending criteria and terms</p>
      </div>
    </div>
  </header>

  <div class="page-content">
    <!-- Create New Rule Section -->
    <div class="create-rule-section" *ngIf="isCreatingRule || editingRuleId">
      <div class="section-header">
        <h2>{{ editingRuleId ? 'Edit Rule' : 'Create New Rule' }}</h2>
        <button class="btn btn-outline" (click)="cancelForm()">
          Cancel
        </button>
      </div>

      <div class="rule-form">
        <div class="form-grid">

          <div class="form-group">
            <label for="minimumLoanAmount">Minimum Loan Amount (₹) *</label>
            <div class="input-wrapper">
              <div class="input-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="12" y1="1" x2="12" y2="23"/>
                  <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                </svg>
              </div>
              <input 
                type="number" 
                id="minimumLoanAmount" 
                [(ngModel)]="ruleData.minimumLoanAmount" 
                name="minimumLoanAmount"
                placeholder="Minimum amount"
                required
              >
            </div>
          </div>

          <div class="form-group">
            <label for="maximumLoanAmount">Maximum Loan Amount (₹) *</label>
            <div class="input-wrapper">
              <div class="input-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="12" y1="1" x2="12" y2="23"/>
                  <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                </svg>
              </div>
              <input 
                type="number" 
                id="maximumLoanAmount" 
                [(ngModel)]="ruleData.maximumLoanAmount" 
                name="maximumLoanAmount"
                placeholder="Maximum amount"
                required
              >
            </div>
          </div>

          <div class="form-group">
            <label for="interestRate">Interest Rate (%) *</label>
            <div class="input-wrapper">
              <div class="input-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M9 12l2 2 4-4"/>
                  <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"/>
                  <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3"/>
                </svg>
              </div>
              <input 
                type="number" 
                id="interestRate" 
                [(ngModel)]="ruleData.interestRate" 
                name="interestRate"
                placeholder="Interest rate percentage"
                min="0" 
                max="50"
                step="0.1"
                required
              >
            </div>
          </div>

          <div class="form-group">
            <label for="minimumCreditScore">Minimum Credit Score *</label>
            <div class="input-wrapper">
              <div class="input-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M9 12l2 2 4-4"/>
                  <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"/>
                  <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3"/>
                </svg>
              </div>
              <input 
                type="number" 
                id="minimumCreditScore" 
                [(ngModel)]="ruleData.minimumCreditScore" 
                name="minimumCreditScore"
                placeholder="Minimum credit score"
                min="300" 
                max="850"
                required
              >
            </div>
          </div>

          <div class="form-group">
            <label for="minimumAge">Minimum Age *</label>
            <div class="input-wrapper">
              <div class="input-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                  <circle cx="12" cy="7" r="4"/>
                </svg>
              </div>
              <input 
                type="number" 
                id="minimumAge" 
                [(ngModel)]="ruleData.minimumAge" 
                name="minimumAge"
                placeholder="Minimum age"
                min="18" 
                max="65"
                required
              >
            </div>
          </div>

          <div class="form-group">
            <label for="maximumAge">Maximum Age *</label>
            <div class="input-wrapper">
              <div class="input-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                  <circle cx="12" cy="7" r="4"/>
                </svg>
              </div>
              <input 
                type="number" 
                id="maximumAge" 
                [(ngModel)]="ruleData.maximumAge" 
                name="maximumAge"
                placeholder="Maximum age"
                min="18" 
                max="65"
                required
              >
            </div>
          </div>

          <div class="form-group">
            <label for="minimumSalary">Minimum Monthly Salary (₹) *</label>
            <div class="input-wrapper">
              <div class="input-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="12" y1="1" x2="12" y2="23"/>
                  <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                </svg>
              </div>
              <input 
                type="number" 
                id="minimumSalary" 
                [(ngModel)]="ruleData.minimumSalary" 
                name="minimumSalary"
                placeholder="Minimum monthly salary"
                required
              >
            </div>
          </div>

          <div class="form-group">
            <label for="employmentTypes">Employment Types *</label>
            <div class="input-wrapper">
              <div class="input-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 13.255A23.931 23.931 0 0 1 12 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2-2v2m8 0V6a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2V6"/>
                </svg>
              </div>
              <select 
                id="employmentTypes" 
                [(ngModel)]="ruleData.employmentTypes" 
                name="employmentTypes"
                class="select-input"
                required
              >
                <option value="SALARIED">Salaried</option>
                <option value="SELF_EMPLOYED">Self Employed</option>
                <option value="NOT_EMPLOYED">Not Employed</option>
              </select>
            </div>
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-primary" (click)="saveRule()" [disabled]="loading">
            <span *ngIf="!loading">{{ editingRuleId ? 'Update Rule' : 'Create Rule' }}</span>
            <span *ngIf="loading" class="loading-spinner">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 12a9 9 0 11-6.219-8.56"/>
              </svg>
            </span>
          </button>
        </div>
      </div>
    </div>

    <!-- Existing Rules Section -->
    <div class="existing-rules-section">
      <div class="section-header">
        <h2>Existing Rules</h2>
        <button class="btn btn-primary" (click)="startCreatingRule()" [disabled]="isCreatingRule || editingRuleId">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 5v14"/>
            <path d="M5 12h14"/>
          </svg>
          Create New Rule
        </button>
      </div>

      <div class="rules-grid" *ngIf="myRules.length > 0; else noRules">
        <div class="rule-card" *ngFor="let rule of myRules">
          <div class="card-header">
            <h3>Rule #{{ rule.id }}</h3>
            <div class="interest-rate">{{ rule.interestRate }}%</div>
          </div>
          <div class="card-content">
            <div class="info-row">
              <span class="label">Loan Range:</span>
              <span class="value">₹{{ rule.minimumLoanAmount | number }} - ₹{{ rule.maximumLoanAmount | number }}</span>
            </div>
            <div class="info-row">
              <span class="label">Credit Score:</span>
              <span class="value">≥ {{ rule.minimumCreditScore }}</span>
            </div>
            <div class="info-row">
              <span class="label">Age Range:</span>
              <span class="value">{{ rule.minimumAge }} - {{ rule.maximumAge }} years</span>
            </div>
            <div class="info-row">
              <span class="label">Min Salary:</span>
              <span class="value">₹{{ rule.minimumSalary | number }}</span>
            </div>
            <div class="info-row">
              <span class="label">Employment:</span>
              <span class="value">{{ rule.employmentTypes }}</span>
            </div>
            <div class="info-row">
              <span class="label">Status:</span>
              <span class="value">{{ rule.ruleStatus }}</span>
            </div>
          </div>
          <div class="card-actions">
            <button class="btn btn-outline" (click)="startEditingRule(rule)">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
              </svg>
              Edit
            </button>
            <button class="btn btn-danger" (click)="deleteRule(rule.id)">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="3,6 5,6 21,6"/>
                <path d="M19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2"/>
              </svg>
              Delete
            </button>
          </div>
        </div>
      </div>

      <ng-template #noRules>
        <div class="empty-state">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
          </svg>
          <h3>No rules yet</h3>
          <p>Create your first lending rule to get started</p>
          <button class="btn btn-primary" (click)="startCreatingRule()">
            Create First Rule
          </button>
        </div>
      </ng-template>
    </div>

    <!-- Error Message -->
    <div class="error-message" *ngIf="error">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"/>
        <line x1="15" y1="9" x2="9" y2="15"/>
        <line x1="9" y1="9" x2="15" y2="15"/>
      </svg>
      <span>{{ error }}</span>
    </div>
  </div>
</div>
